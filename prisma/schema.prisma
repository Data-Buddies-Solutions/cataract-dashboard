generator client {
  provider = "prisma-client"
  output   = "../app/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model Patient {
  id              String    @id @default(cuid())
  name            String
  firstName       String?
  lastName        String?
  phone           String?
  email           String?
  notes           String?
  dateOfBirth     DateTime?
  appointmentDate DateTime?
  doctor          String?
  callStatus      String    @default("pending")
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  calls           WebhookEvent[]

  @@index([callStatus])
  @@index([appointmentDate])
  @@index([lastName, firstName])
}

model WebhookEvent {
  id              String   @id @default(cuid())
  type            String
  eventTimestamp  Int
  agentId         String?
  conversationId  String?  @unique
  status          String?
  data            Json
  createdAt       DateTime @default(now())

  // Extracted cataract-specific columns
  callSuccessful  Boolean?
  callDurationSecs Float?
  visionScale     Int?
  activities      String?
  visionPreference String?

  // Post-call communication
  patientEmail       String?
  patientEmailSentAt DateTime?
  doctorEmailSentAt  DateTime?
  videoUrl           String?
  videoStatus        String?

  // Patient relationship
  patientId       String?
  patient         Patient? @relation(fields: [patientId], references: [id])

  @@index([type])
  @@index([conversationId])
  @@index([createdAt])
  @@index([patientId])
  @@index([callSuccessful])
  @@index([visionScale])
  @@index([visionPreference])
}
